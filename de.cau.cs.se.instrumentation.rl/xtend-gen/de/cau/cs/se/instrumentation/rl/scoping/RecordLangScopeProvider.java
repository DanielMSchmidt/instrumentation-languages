/**
 * generated by Xtext
 */
package de.cau.cs.se.instrumentation.rl.scoping;

import de.cau.cs.se.instrumentation.rl.recordLang.Classifier;
import de.cau.cs.se.instrumentation.rl.recordLang.Property;
import de.cau.cs.se.instrumentation.rl.recordLang.ReferenceProperty;
import de.cau.cs.se.instrumentation.rl.scoping.MyPredicate;
import java.util.Collection;
import java.util.List;
import org.eclipse.emf.common.util.EList;
import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EClassifier;
import org.eclipse.emf.ecore.EGenericType;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.EPackage;
import org.eclipse.emf.ecore.EReference;
import org.eclipse.emf.ecore.EStructuralFeature;
import org.eclipse.xtext.EcoreUtil2;
import org.eclipse.xtext.scoping.IScope;
import org.eclipse.xtext.scoping.Scopes;
import org.eclipse.xtext.scoping.impl.AbstractDeclarativeScopeProvider;
import org.eclipse.xtext.scoping.impl.FilteringScope;

/**
 * This class contains custom scoping description.
 * 
 * see : http://www.eclipse.org/Xtext/documentation.html#scoping
 * on how and when to use it
 */
@SuppressWarnings("all")
public class RecordLangScopeProvider extends AbstractDeclarativeScopeProvider {
  /**
   * Find scope for the package property in the Package rule.
   * 
   * @param context
   *            The Package-object of the resulting model.
   * @param reference
   *            The EReference-reference object of the AST.
   * @return The scope for the package attribute.
   */
  public IScope scope_Package_package(final de.cau.cs.se.instrumentation.rl.recordLang.Package context, final EReference reference) {
    IScope _delegateGetScope = this.delegateGetScope(context, reference);
    MyPredicate _myPredicate = new MyPredicate();
    FilteringScope _filteringScope = new FilteringScope(_delegateGetScope, _myPredicate);
    final IScope result = _filteringScope;
    return result;
  }
  
  /**
   * @param classifier
   * @param reference
   * @return
   */
  public IScope scope_Classifier_class(final Classifier context, final EReference reference) {
    de.cau.cs.se.instrumentation.rl.recordLang.Package _package = context.getPackage();
    EPackage _package_1 = _package.getPackage();
    List<EClassifier> _allContentsOfType = EcoreUtil2.<EClassifier>getAllContentsOfType(_package_1, EClassifier.class);
    return Scopes.scopeFor(_allContentsOfType);
  }
  
  public IScope scope_ReferenceProperty_ref(final ReferenceProperty property, final EReference reference) {
    EObject _eContainer = property.eContainer();
    final EObject _switchValue = _eContainer;
    boolean _matched = false;
    if (!_matched) {
      if (_switchValue instanceof Property) {
        final Property _property = (Property)_switchValue;
        _matched=true;
        EObject _eContainer_1 = property.eContainer();
        Classifier _type = ((Property) _eContainer_1).getType();
        EClassifier _class_ = _type.getClass_();
        Collection<EStructuralFeature> _allProperties = this.getAllProperties(_class_, EStructuralFeature.class);
        return Scopes.scopeFor(_allProperties);
      }
    }
    if (!_matched) {
      if (_switchValue instanceof ReferenceProperty) {
        final ReferenceProperty _referenceProperty = (ReferenceProperty)_switchValue;
        _matched=true;
        EObject _eContainer_1 = property.eContainer();
        final EStructuralFeature parent = ((ReferenceProperty) _eContainer_1).getRef();
        if ((parent instanceof EReference)) {
          EClass _eReferenceType = ((EReference) parent).getEReferenceType();
          Collection<EStructuralFeature> _allProperties = this.getAllProperties(_eReferenceType, EStructuralFeature.class);
          return Scopes.scopeFor(_allProperties);
        } else {
          return null;
        }
      }
    }
    return null;
  }
  
  public Collection<EStructuralFeature> getAllProperties(final EClassifier classifier, final Class<EStructuralFeature> type) {
    final List<EStructuralFeature> result = EcoreUtil2.<EStructuralFeature>getAllContentsOfType(classifier, type);
    if ((classifier instanceof EClass)) {
      EList<EGenericType> _eGenericSuperTypes = ((EClass) classifier).getEGenericSuperTypes();
      for (final EGenericType generic : _eGenericSuperTypes) {
        EClassifier _eClassifier = generic.getEClassifier();
        Collection<EStructuralFeature> _allProperties = this.getAllProperties(_eClassifier, type);
        result.addAll(_allProperties);
      }
    }
    return result;
  }
}
